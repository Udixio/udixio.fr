---
import {getCollection, render} from 'astro:content';
import Layout from "../../layouts/Layout.astro";
import {BackgroundColor} from "../../components/BackgroundColor";
import {Project, ProjectProps} from "@components/Project";
import {Button, Card} from "@udixio/ui"
import {getImage} from "astro:assets";
import {UpdateTheme} from "../../components/UpdateTheme";
import {faArrowLeft} from "@fortawesome/pro-regular-svg-icons";
import myBackground from "@assets/renders/netsimpler.webp"

export async function getStaticPaths() {
    const realisations = await getCollection('realisation');
    return realisations.map((realisation) => ({
        params: {slug: realisation.id},
        props: {realisation},
    }));
}
const {realisation} = Astro.props;
const {Content} = await render(realisation);

const images = import.meta.glob('@assets/renders/*.webp', {eager: true});


if (!realisation.data.images.background) {
    const imageFileName = `${realisation.id}.webp`;

    const imageEntry = ((Object.entries(images).find(([path]) =>
        path.endsWith(imageFileName)
    ))?.[1] as any).default;
    const background = await getImage({src: imageEntry, format: 'webp'})
    realisation.data.images.background = {
        src: (background).src,
        alt: ""
    }
}

const projectProps: ProjectProps = {
    slug: realisation.id,
    ...realisation.data,
    images: {
        ...realisation.data.images,
        background: realisation.data.images.background,
    },
}
---

<Layout>
    <UpdateTheme client:only="react"
                 theme={{isDark: realisation.data.theme.isDark, source: realisation.data.theme.source}}/>
    <Project client:load {...projectProps}
    >
        <Content/>
    </Project>
</Layout>
